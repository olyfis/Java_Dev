package com.olympus.webreport;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.io.PrintWriter;
import java.net.InetAddress;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.Properties;

import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.DocumentBuilder;
import org.w3c.dom.Document;
import org.w3c.dom.NodeList;

import com.olympus.util.JButils;

import org.w3c.dom.Node;
import org.w3c.dom.Element;
import javax.servlet.Servlet;
import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**********************************************************************************************************/	
/**********************************************************************************************************/	

/**********************************************************************************************************/	

/**********************************************************************************************************/	
public class GetQuoteData  extends HttpServlet {
	static String sep = ":";
	/**********************************************************************************************************/	
	// Service method of servlet
	static Statement stmt = null;
	static Connection con = null;
	static ResultSet res  = null;
	static NodeList  node  = null;
	static String s = null;
	static private PreparedStatement statement;
	private static final String FILE_NAME = "c:\\temp\\RapportBookingSummary.xls";
	private static final String FILE_NAME2 = "rapsum.xls";
/**********************************************************************************************************/	
	
	public static ArrayList<String> resultSetArray(ResultSet rs, String sep) throws SQLException {

		ArrayList<String> arrStr = new ArrayList<String>();
		ArrayList<String> xData = new ArrayList<String>();
		String outDataLine = "";
		ResultSetMetaData rsmd = rs.getMetaData();
		int numColumns = rsmd.getColumnCount();
		int columnsNumber = rsmd.getColumnCount();
		while (rs.next()) {
			for (int i = 1; i <= columnsNumber; i++) {
				if (i > 1) {
					// System.out.print(sep);
					outDataLine += sep;
				}
				String columnValue = rs.getString(i);
				outDataLine += columnValue;
			}
			// System.out.println(outDataLine);
			arrStr.add(outDataLine);
			// System.out.println("");
			outDataLine = "";
		}
		return arrStr;
	}

/**********************************************************************************************************/	
public static ArrayList<String> getData(String appKey, String sep) throws IOException {
	
		ArrayList<String> result = null;

		BookingReport br2 = new BookingReport();
		ArrayList<String> strArr = new ArrayList<String>();

		JButils jutil = new JButils();
		FileInputStream fis = null;

		String hostname = InetAddress.getLocalHost().getHostName();
		try {
			fis = new FileInputStream(connProp);
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		Properties connectionProps = new Properties();
		String s = new String();
		StringBuffer sb = new StringBuffer();

		try {
			connectionProps.load(fis);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		FileReader fr = new FileReader(new File(sqlFile));

		return result;
	}

	/**********************************************************************************************************/


	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse res) 
			throws ServletException, IOException {
		
		
		//PrintWriter out = res.getWriter();
		res.setContentType("text/plain");

		String appKey = "appKey";
		String appKeyValue = req.getParameter(appKey);
		
	
		
		if (appKeyValue != null) {
			//out.write("Parameter " + paramName + " found");
			System.out.println("PARAM:" + appKeyValue + "---");
			res.getWriter().println("****PARMVal=" + appKeyValue + "---<BR>");
		}

		//out.close();
		// call with app_ID=101-0017172-001
		ArrayList<String> strArr = getData(appKeyValue, sep);	
		//printName(xData);
		req.getSession().setAttribute( appKey, appKeyValue);
		req.getSession().setAttribute("strArr", strArr);
       // req.getRequestDispatcher("/appdata2.jsp").forward(req, res);
		
		return;
		
	}
	
	/**********************************************************************************************************/	

    
	@Override
	public void init() throws ServletException {
		System.out.println("Servlet " + this.getServletName() + " has started");
	}
	/**********************************************************************************************************/	

	@Override
	public void destroy() {
		System.out.println("Servlet " + this.getServletName() + " has stopped");
	}
	
}
