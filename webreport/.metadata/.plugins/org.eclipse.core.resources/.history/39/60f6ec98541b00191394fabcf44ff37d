package com.olympus.webreport;
import java.io.File;
import java.io.IOException;
import java.io.PrintWriter;
import java.net.InetAddress;
import java.util.ArrayList;
import javax.servlet.Servlet;
import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.DocumentBuilder;
import org.w3c.dom.Document;
import org.w3c.dom.NodeList;
import org.w3c.dom.Node;
import org.w3c.dom.Element;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.util.Iterator;
import java.util.Properties;
import java.util.Set;
import com.olympus.util.JButils;
import org.w3c.dom.NodeList;
import java.sql.*;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;

@WebServlet("/GetChartData")
public class GetChartData extends HttpServlet {

/************************************************************************************************************************************************/
	
	
//method to print array
public static void printName(ArrayList<String> line_arr){

		// iterating ArrayList
		for (String str : line_arr)
			System.out.println("DATA:" + str + "---");

		// System.out.println(names[index]);
}
/************************************************************************************************************************************************/
public static ArrayList<String> getXMLdata() {
		
		String status = null;
		String percentShipped = null;
		String category = null;
		String matGrp = null;
		String matModel = null;
		String outData = null;
		String outDataLine = null;
		int count = 0;
		ArrayList<String> lines = new ArrayList<String>();
		ArrayList<String> xData = new ArrayList<String>();
		
		try {
		    File fXmlFile = new File("d:\\Pentaho\\Kettle\\Dashboard\\XML\\dashboard_NF\\sharepoint_NF.xml");
		    DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();
		    DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();
		    Document doc = dBuilder.parse(fXmlFile);
		    doc.getDocumentElement().normalize();

		    System.out.println("Root element :" + doc.getDocumentElement().getNodeName());
		    NodeList nList = doc.getElementsByTagName("SharePt_r");
		    System.out.println("----------------------------");

		    for (int temp = 0; temp < nList.getLength(); temp++) {
		        Node nNode = nList.item(temp);
		        //System.out.println("\nCurrent Element :" + nNode.getNodeName());
		        if (nNode.getNodeType() == Node.ELEMENT_NODE) {
		            Element eElement = (Element) nNode;
		        	status = eElement.getElementsByTagName("CO_UD_CO_APP_STATUS_TBDESC").item(0).getTextContent();
    	            percentShipped = eElement.getElementsByTagName("Percent_Ship").item(0).getTextContent();
    	            percentShipped = percentShipped.replace("%","");
    	            //int percent = Integer.parseInt(percentShipped);	
    	            
    	            //if (status.matches("Order Released") && (percent > 95)) {
    	            
    	            if (status.matches("Order Released")) {
    	            	  //System.out.println("\nCurrent Element :" + nNode.getNodeName());
    	            	  
    	            	  System.out.println("\nCurrent Element:" + status + "Percent Shipped:" + percentShipped);
    	            }
    	            
    	            //outDataLine =  status + ":" + percentShipped;
    	            //lines.add(outDataLine);
     	           
    	            
    	            /*
    	            if ('C' == oStat.charAt(0) ) {
    	            	oStat = "Shipped";
    	            } else if ('A' == oStat.charAt(0) ) {
    	            	oStat = "On-Order";
    	            }
    	        	category = eElement.getElementsByTagName("Item_Category").item(0).getTextContent();
    	        	matGrp = eElement.getElementsByTagName("Material_Group").item(0).getTextContent();
    	        	matModel = eElement.getElementsByTagName("Material_Model_Number").item(0).getTextContent();
    	            
    	        	if (appNum.equals(appID)) {
    	        		count++;
    	        		/*
    	        	   	System.out.println("ID:" + appID + "---");
	    	        	System.out.println("Customer_PO:" + appNum  + "---");
	    	        	System.out.println("Overall_Status:" + oStat  + "---");
	    	        	System.out.println("Item_Category:" + category  + "---");
	    	        	System.out.println("Material_Group:" + matGrp  + "---");
	    	        	System.out.println("Material_Model_Number:" + matModel  + "---");
	    	        	
    	        		outDataLine =  status + ":" + percent_Shipped + ":" + category + ":" + matGrp + ":" + matModel;
    	        		outData += appNum + ":" + oStat + ":" + category + ":" + matGrp + ":" + matModel + "<BR>";
    	        	
    	        		
    	        		
    	        		lines.add(outDataLine);
    	           
    	        	}
		         		*/
		        }
		    }
		    } catch (Exception e) {
		    e.printStackTrace();
		    }
		return lines;
		
}		
/************************************************************************************************************************************************/
/************************************************************************************************************************************************/
/************************************************************************************************************************************************/
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse res) 
		throws ServletException, IOException {
	
	ArrayList<String> xData = getXMLdata();	
	printName(xData);
	
}
 
/************************************************************************************************************************************************/

}
